{% extends 'accounts/dashboard/base_dashboard.html' %}

{% block title %}Dashboard | My Reservations{% endblock %}

{% block sidebar %}
    <a href="{% url 'customer_dashboard' %}" class="{% if request.resolver_match.url_name == 'customer_dashboard' %}active{% endif %}">
        <i class="fa-solid fa-chart-line me-2"></i> Analytics
    </a>
    <a href="{% url 'my_orders' %}" class="{% if request.resolver_match.url_name == 'my_orders' %}active{% endif %}">
        <i class="fa-solid fa-shopping-bag me-2"></i> My Orders
    </a>
    <a href="{% url 'create_reservation' %}" class="{% if request.resolver_match.url_name == 'create_reservation' %}active{% endif %}">
        <i class="fa-solid fa-calendar-plus me-2"></i> Book Table
    </a>
    <a href="{% url 'reservation_list' %}" class="{% if request.resolver_match.url_name == 'reservation_list' %}active{% endif %}">
        <i class="fa-solid fa-list-ul me-2"></i> My Reservations
    </a>
    <a href="{% url 'add_review' %}" class="{% if request.resolver_match.url_name == 'add_review' %}active{% endif %}">
        <i class="fa-solid fa-pen-fancy me-2"></i> Create Review
    </a>
    <a href="{% url 'my_testimonials' %}" class="{% if request.resolver_match.url_name == 'my_testimonials' %}active{% endif %}">
        <i class="fa-solid fa-star me-2"></i> My Reviews
    </a>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold m-0">My Reservations</h2>
    <a href="{% url 'create_reservation' %}" class="btn btn-danger btn-sm rounded-pill px-4 py-2 shadow-sm">
        <i class="fa-solid fa-plus me-1"></i> New Booking
    </a>
</div>

<div class="card border-0 shadow-sm rounded-4 overflow-hidden">
    <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
            <thead class="bg-light">
                <tr class="text-muted small fw-bold">
                    <th class="ps-4 py-3">DATE</th>
                    <th class="py-3">TIME</th>
                    <th class="py-3">PEOPLE</th>
                    <th class="py-3">STATUS</th>
                    <th class="py-3">SPECIAL REQUEST</th>
                    <th class="text-center pe-4 py-3">ACTION</th>
                </tr>
            </thead>
            <tbody>
                {% for r in reservations %}
                <tr class="border-bottom">
                    <td class="ps-4 py-4 fw-bold text-dark">{{ r.date }}</td>
                    <td class="py-4 text-dark">{{ r.time }}</td>
                    <td class="py-4">
                        <span class="badge bg-light text-dark border px-3 py-2">
                            <i class="fa-solid fa-users me-1 text-muted"></i> {{ r.people_count }}
                        </span>
                    </td>
                    <td class="py-4">
                        {% if r.status == 'Confirmed' %}
                            <span class="badge bg-success-subtle text-success px-3 py-2 rounded-pill">Confirmed</span>
                        {% elif r.status == 'Pending' %}
                            <span class="badge bg-warning-subtle text-warning px-3 py-2 rounded-pill">Pending</span>
                        {% else %}
                            <span class="badge bg-secondary-subtle text-secondary px-3 py-2 rounded-pill">{{ r.status }}</span>
                        {% endif %}
                    </td>
                    <td class="py-4 text-muted small">
                        {{ r.special_request|truncatechars:30|default:"<span class='opacity-50'>-</span>"|safe }}
                    </td>
                    
                    <td class="text-center pe-4 py-4">
                        <div class="d-flex justify-content-center gap-2">
                            <a href="{% url 'edit_reservation' r.id %}" class="btn btn-outline-primary btn-sm rounded-circle" title="Edit" style="width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;">
                                <i class="fa-solid fa-pen-to-square"></i>
                            </a>
                            
                            <form action="{% url 'delete_reservation' r.id %}" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to cancel this booking?');">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-outline-danger btn-sm rounded-circle" title="Cancel" style="width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;">
                                    <i class="fa-solid fa-trash-can"></i>
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center py-5 text-muted">
                        <i class="fa-solid fa-calendar-xmark d-block mb-3 fs-1 opacity-25"></i>
                        No reservations found.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<style>
    /* Status Badge Colors */
    .bg-success-subtle { background-color: #e8f5e9; }
    .bg-warning-subtle { background-color: #fff3e0; }
    .bg-secondary-subtle { background-color: #f5f5f5; }
    
    .table tbody tr:hover {
        background-color: #fafafa;
    }
    
    .badge {
        font-weight: 600;
        letter-spacing: 0.3px;
    }
</style>
{% endblock %}
{% extends "accounts/dashboard/base_dashboard.html" %}
{% load static %}
{% block sidebar %}
    {% url 'staff_analytics' as a %}{% url 'staff_inventory' as i %}{% url 'staff_top_selling' as t %}{% url 'staff_dashboard' as d %}{% url 'staff_blog_list' as bl %}{% url 'staff_create_blog' as bc %}
    
    <a href="{{ a }}" class="nav-link-custom {% if request.path == a %}active{% endif %}" style="--clr: #FF4757;">
        <i class="fa-solid fa-chart-pie me-2"></i> Analytics
    </a>
    <a href="{{ i }}" class="nav-link-custom {% if request.path == i %}active{% endif %}" style="--clr: #2ED573;">
        <i class="fa-solid fa-boxes-stacked me-2"></i> Inventory
    </a>
    <a href="{{ t }}" class="nav-link-custom {% if request.path == t %}active{% endif %}" style="--clr: #FFA502;">
        <i class="fa-solid fa-fire me-2 fa-beat-low"></i> Top Selling
    </a>
      {% url 'all_reservations' as res_list %}
    <a href="{{ res_list }}" class="nav-link-custom {% if request.path == res_list %}active{% endif %}" style="--clr: #8e44ad;">
        <i class="fa-solid fa-calendar-check me-2"></i> All Reservations
    </a>

    <hr class="opacity-10 mx-3">
    
    <a href="{{ d }}" class="nav-link-custom {% if request.path == d and not request.GET.payment and not request.GET.status %}active{% endif %}" style="--clr: #1E90FF;">
        <i class="fa-solid fa-receipt me-2"></i> All Orders
    </a>
    <a href="{{ d }}?payment=PAID" class="nav-link-custom {% if request.GET.payment == 'PAID' %}active{% endif %}" style="--clr: #00D2D3;">
        <i class="fa-solid fa-circle-check me-2"></i> Paid Orders
    </a>
    <a href="{{ d }}?status=PENDING" class="nav-link-custom {% if request.GET.status == 'PENDING' %}active{% endif %}" style="--clr: #FF9F43;">
        <i class="fa-solid fa-clock me-2 fa-spin-hover"></i> New Orders 
        <span class="badge rounded-pill bg-danger ms-auto">New</span>
    </a>

    <hr class="opacity-10 mx-3">

    {% url 'admin_intelligence' as intel %}
    <a href="{{ intel }}" class="nav-link-custom {% if request.path == intel %}active{% endif %}" style="--clr: #6C5CE7;">
        <i class="fa-solid fa-brain me-2"></i> AI Intelligence
    </a>

    {% url 'staff_operation_pulse' as pulse %}
    <a href="{{ pulse }}" class="nav-link-custom {% if request.path == pulse %}active{% endif %}" style="--clr: #10B981;">
        <i class="fa-solid fa-bolt-lightning me-2 fa-pulse"></i> Operation Pulse
        <span class="pulse-dot"></span>
    </a>

    <hr class="opacity-10 mx-3">

    <a href="{{ bl }}" class="nav-link-custom {% if request.path == bl %}active{% endif %}" style="--clr: #A29BFE;">
        <i class="fa-solid fa-newspaper me-2"></i> Blogs
    </a>
    <a href="{{ bc }}" class="nav-link-custom {% if request.path == bc %}active{% endif %}" style="--clr: #FF6B81; font-weight: bold;">
        <i class="fa-solid fa-plus-circle me-2"></i> Create Blog
    </a>

{% endblock %}

{% block content %}
<div class="container-fluid p-0">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold mb-0">Operation Pulse</h3>
        <span class="badge bg-dark rounded-pill px-3">Live Prediction</span>
    </div>

    <div class="row g-3 mb-4">
        <div class="col-md-6">
            <div class="card border-0 shadow-sm rounded-4 p-4 bg-primary text-white">
                <h6 class="text-white-50 small fw-bold text-uppercase">Peak Order Time</h6>
                <h2 class="fw-bold mb-0">{{ busy_hour }}</h2>
                <p class="small mb-0 mt-2 opacity-75">এই সময়ে আপনার সবচেয়ে বেশি স্টাফ প্রয়োজন হয়।</p>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card border-0 shadow-sm rounded-4 p-4 border-start border-warning border-5">
                <h6 class="text-muted small fw-bold text-uppercase">Insights Captured</h6>
                <h2 class="fw-bold mb-0 text-dark">{{ total_insights }} Orders Analyzed</h2>
                <p class="small mb-0 mt-2 text-muted">গত সকল ডাটার ওপর ভিত্তি করে এই রিপোর্ট তৈরি।</p>
            </div>
        </div>
    </div>

    <div class="card border-0 shadow-sm rounded-4 p-4 mb-4">
        <h6 class="fw-bold mb-4"><i class="fa-solid fa-chart-area me-2 text-primary"></i>Hourly Traffic Heatmap</h6>
        <div style="height: 350px;">
            <canvas id="peakHourChart"></canvas>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    new Chart(document.getElementById('peakHourChart').getContext('2d'), {
        type: 'bar',
        data: {
            labels: {{ hour_labels|safe }},
            datasets: [{
                label: 'Orders',
                data: {{ hour_data|safe }},
                backgroundColor: 'rgba(99, 102, 241, 0.5)',
                borderColor: '#6366f1',
                borderWidth: 2,
                borderRadius: 5,
                hoverBackgroundColor: '#4f46e5'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, grid: { color: '#f3f4f6' } },
                x: { grid: { display: false } }
            }
        }
    });
</script>
{% endblock %}
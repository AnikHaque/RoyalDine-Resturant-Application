{% extends "accounts/dashboard/base_dashboard.html" %}
{% load static %}
{% block sidebar %}
    {% url 'staff_analytics' as a %}{% url 'staff_inventory' as i %}{% url 'staff_top_selling' as t %}{% url 'staff_dashboard' as d %}{% url 'staff_blog_list' as bl %}{% url 'staff_create_blog' as bc %}
    
    <a href="{{ a }}" class="nav-link-custom {% if request.path == a %}active{% endif %}" style="--clr: #FF4757;">
        <i class="fa-solid fa-chart-pie me-2"></i> Analytics
    </a>
    <a href="{{ i }}" class="nav-link-custom {% if request.path == i %}active{% endif %}" style="--clr: #2ED573;">
        <i class="fa-solid fa-boxes-stacked me-2"></i> Inventory
    </a>
    <a href="{{ t }}" class="nav-link-custom {% if request.path == t %}active{% endif %}" style="--clr: #FFA502;">
        <i class="fa-solid fa-fire me-2 fa-beat-low"></i> Top Selling
    </a>
      {% url 'all_reservations' as res_list %}
    <a href="{{ res_list }}" class="nav-link-custom {% if request.path == res_list %}active{% endif %}" style="--clr: #8e44ad;">
        <i class="fa-solid fa-calendar-check me-2"></i> All Reservations
    </a>

    <hr class="opacity-10 mx-3">
    
    <a href="{{ d }}" class="nav-link-custom {% if request.path == d and not request.GET.payment and not request.GET.status %}active{% endif %}" style="--clr: #1E90FF;">
        <i class="fa-solid fa-receipt me-2"></i> All Orders
    </a>
    <a href="{{ d }}?payment=PAID" class="nav-link-custom {% if request.GET.payment == 'PAID' %}active{% endif %}" style="--clr: #00D2D3;">
        <i class="fa-solid fa-circle-check me-2"></i> Paid Orders
    </a>
    <a href="{{ d }}?status=PENDING" class="nav-link-custom {% if request.GET.status == 'PENDING' %}active{% endif %}" style="--clr: #FF9F43;">
        <i class="fa-solid fa-clock me-2 fa-spin-hover"></i> New Orders 
        <span class="badge rounded-pill bg-danger ms-auto">New</span>
    </a>

    <hr class="opacity-10 mx-3">

    {% url 'admin_intelligence' as intel %}
    <a href="{{ intel }}" class="nav-link-custom {% if request.path == intel %}active{% endif %}" style="--clr: #6C5CE7;">
        <i class="fa-solid fa-brain me-2"></i> AI Intelligence
    </a>

    {% url 'staff_operation_pulse' as pulse %}
    <a href="{{ pulse }}" class="nav-link-custom {% if request.path == pulse %}active{% endif %}" style="--clr: #10B981;">
        <i class="fa-solid fa-bolt-lightning me-2 fa-pulse"></i> Operation Pulse
        <span class="pulse-dot"></span>
    </a>

    <hr class="opacity-10 mx-3">

    <a href="{{ bl }}" class="nav-link-custom {% if request.path == bl %}active{% endif %}" style="--clr: #A29BFE;">
        <i class="fa-solid fa-newspaper me-2"></i> Blogs
    </a>
    <a href="{{ bc }}" class="nav-link-custom {% if request.path == bc %}active{% endif %}" style="--clr: #FF6B81; font-weight: bold;">
        <i class="fa-solid fa-plus-circle me-2"></i> Create Blog
    </a>

{% endblock %}

{% block content %}
    <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light">
                    <tr>
                        <th class="ps-4 py-3 text-uppercase small fw-bold text-muted" style="width: 80px;">Rank</th>
                        <th class="py-3 text-uppercase small fw-bold text-muted">Dish Details</th>
                        <th class="py-3 text-uppercase small fw-bold text-muted">Sales Performance</th>
                        <th class="py-3 text-uppercase small fw-bold text-muted text-end pe-4">Total Sold</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in top_selling %}
                    <tr class="align-middle">
                        <td class="ps-4">
                            {% if forloop.counter == 1 %}
                                <div class="rank-box bg-warning text-white animate__animated animate__pulse animate__infinite"><i class="fa-solid fa-crown"></i></div>
                            {% elif forloop.counter == 2 %}
                                <div class="rank-box bg-secondary text-white">2</div>
                            {% elif forloop.counter == 3 %}
                                <div class="rank-box bg-bronze text-white" style="background: #cd7f32;">3</div>
                            {% else %}
                                <span class="fw-bold text-muted ms-2">{{ forloop.counter }}</span>
                            {% endif %}
                        </td>

                        <td>
                            <div class="d-flex align-items-center">
                                <div class="dish-icon me-3 bg-light rounded-3 text-primary text-center" style="width: 40px; height: 40px; line-height: 40px;">
                                    <i class="fa-solid fa-utensils"></i>
                                </div>
                                <div>
                                    <h6 class="mb-0 fw-bold">{{ item.food_name }}</h6>
                                    <span class="text-muted small">Category Item</span>
                                </div>
                            </div>
                        </td>

                        <td style="min-width: 200px;">
                            <div class="d-flex align-items-center">
                                <div class="progress flex-grow-1" style="height: 8px; border-radius: 10px;">
                                    <div class="progress-bar bg-primary rounded-pill" 
                                         role="progressbar" 
                                         style="width: {% widthratio item.sales_count top_selling.0.sales_count 100 %}%">
                                    </div>
                                </div>
                                <span class="ms-2 small text-muted">{% widthratio item.sales_count top_selling.0.sales_count 100 %}%</span>
                            </div>
                        </td>

                        <td class="text-end pe-4">
                            <h5 class="mb-0 fw-bold text-dark">{{ item.sales_count }}</h5>
                            <small class="text-success fw-bold"><i class="fa-solid fa-arrow-trend-up me-1"></i>Orders</small>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="text-center py-5">
                            <img src="https://cdn-icons-png.flaticon.com/512/7486/7486744.png" width="80" class="opacity-25 mb-3">
                            <p class="text-muted">No sales data found for this period.</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
    /* Rank Box Style */
    .rank-box {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 0.9rem;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    /* Progress Bar Animation */
    .progress-bar {
        transition: width 1.5s ease-in-out;
        background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%) !important;
    }

    /* Table Hover Effect */
    .table tbody tr {
        transition: all 0.2s ease;
        cursor: pointer;
    }

    .table tbody tr:hover {
        background-color: #f8faff !important;
        transform: scale(1.005);
    }

    /* Custom Scrollbar for Table */
    .table-responsive::-webkit-scrollbar {
        height: 6px;
    }
    .table-responsive::-webkit-scrollbar-thumb {
        background: #dee2e6;
        border-radius: 10px;
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('topSellingChart').getContext('2d');
    
    const gradient = ctx.createLinearGradient(0, 0, 0, 300);
    gradient.addColorStop(0, '#4facfe');
    gradient.addColorStop(1, '#00f2fe');

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: {{ top_selling_labels|safe }},
            datasets: [{
                label: 'Orders',
                data: {{ top_selling_data|safe }},
                backgroundColor: gradient,
                borderRadius: 15,
                barThickness: 25,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, grid: { borderDash: [5, 5] } },
                x: { grid: { display: false } }
            }
        }
    });
});
</script>
{% endblock %}
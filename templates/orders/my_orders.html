{% extends 'accounts/dashboard/base_dashboard.html' %}
{% block title %}Order History | {{ request.user.username }}{% endblock %}
{% block sidebar %}
    {% url 'customer_dashboard' as d_url %}{% url 'my_orders' as o_url %}{% url 'create_reservation' as b_url %}{% url 'reservation_list' as r_url %}{% url 'add_review' as ar_url %}{% url 'my_testimonials' as mt_url %}
    <a href="{{ d_url }}" class="{% if request.path == d_url %}active{% endif %}"><i class="fa-solid fa-chart-line me-2"></i> Analytics</a>
    <a href="{{ o_url }}" class="{% if request.path == o_url %}active{% endif %}"><i class="fa-solid fa-shopping-bag me-2"></i> My Orders</a>
    <a href="{{ b_url }}" class="{% if request.path == b_url %}active{% endif %}"><i class="fa-solid fa-calendar-plus me-2"></i> Book Table</a>
    <a href="{{ r_url }}" class="{% if request.path == r_url %}active{% endif %}"><i class="fa-solid fa-list-ul me-2"></i> Reservations</a>
    <a href="{{ ar_url }}" class="{% if request.path == ar_url %}active{% endif %}"><i class="fa-solid fa-pen-fancy me-2"></i> Create Review</a>
    <a href="{{ mt_url }}" class="{% if request.path == mt_url %}active{% endif %}"><i class="fa-solid fa-star me-2"></i> My Reviews</a>
{% endblock %}
{% block content %}
<div class="container-fluid p-0">
    <div class="row mb-3 align-items-center">
        <div class="col-6"><h4 class="fw-bold m-0">Order History</h4><p class="text-muted small mb-0">Track and manage orders.</p></div>
        <div class="col-6 text-end"><a href="{% url 'menu' %}" class="btn btn-danger btn-sm px-3 fw-bold rounded-3">New Order</a></div>
    </div>
    <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
        <div class="table-responsive"><table class="table table-hover align-middle mb-0 small">
            <thead class="bg-light fw-bold text-muted"><tr>
                <th class="ps-3 py-3">ID</th><th class="py-3">DATE</th><th class="py-3">TOTAL</th><th class="py-3">PAYMENT</th><th class="py-3">STATUS</th><th class="text-end pe-3">ACTIONS</th>
            </tr></thead>
            <tbody>
                {% for order in orders %}<tr class="border-bottom">
                    <td class="ps-3 fw-bold">#{{ order.id }}</td>
                    <td><div class="fw-bold">{{ order.created_at|date:"d M" }}</div><div class="text-muted x-small">{{ order.created_at|date:"H:i" }}</div></td>
                    <td class="fw-bold">à§³{{ order.total_price }}</td>
                    <td><span class="badge rounded-pill px-2 py-1 {% if order.is_paid %}bg-success-subtle text-success{% else %}bg-warning-subtle text-warning{% endif %}">{% if order.is_paid %}Paid{% else %}Unpaid{% endif %}</span></td>
                    <td><span class="badge bg-info-subtle text-info rounded-pill px-2 py-1">{{ order.get_status_display }}</span></td>
                    <td class="text-end pe-3"><div class="d-flex justify-content-end gap-1">
                        <a href="{% url 'track_order' order.id %}" class="btn btn-sm btn-outline-danger px-2 rounded-pill">Track</a>
                        <form action="{% url 'delete_order' order.id %}" method="POST" class="d-inline">{% csrf_token %}
                            <button class="btn btn-sm btn-light px-2 rounded-pill text-danger" onclick="return confirm('Delete?');"><i class="fa-solid fa-trash-can"></i></button>
                        </form>
                    </div></td>
                </tr>{% empty %}
                <tr><td colspan="6" class="text-center py-5 text-muted">No orders found. <a href="{% url 'menu' %}">Order now</a></td></tr>{% endfor %}
            </tbody>
        </table></div>
    </div>
</div>
<style>
    .bg-success-subtle { background:#e8f5e9!important; color:#2e7d32!important; } .bg-warning-subtle { background:#fff3e0!important; color:#ef6c00!important; }
    .bg-info-subtle { background:#e0f7fa!important; color:#00838f!important; } .x-small { font-size: 0.65rem; } .badge { font-size: 0.7rem; }
</style>
{% endblock %}
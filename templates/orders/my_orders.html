{% extends 'accounts/dashboard/base_dashboard.html' %}
{% block title %}Dashboard | Welcome {{ request.user.username }}{% endblock %}

{% block sidebar %}
    {% url 'customer_dashboard' as dash %}{% url 'my_orders' as orders %}
    {% url 'create_reservation' as book %}{% url 'reservation_list' as res_list %}
    {% url 'add_review' as add_rev %}{% url 'my_testimonials' as my_testi %}
    <a href="{{ dash }}" class="{% if request.path == dash %}active{% endif %}"><i class="fa-solid fa-chart-line"></i> Analytics</a>
    <a href="{{ orders }}" class="{% if request.path == orders %}active{% endif %}"><i class="fa-solid fa-shopping-bag"></i> My Orders</a>
    <a href="{{ book }}" class="{% if request.path == book %}active{% endif %}"><i class="fa-solid fa-calendar-plus"></i> Book Table</a>
    <a href="{{ res_list }}" class="{% if request.path == res_list %}active{% endif %}"><i class="fa-solid fa-list-ul"></i> My Reservations</a>
    <a href="{% url 'my_payments' %}" class="{% if request.path == '/accounts/dashboard/payments/' %}active{% endif %}">
    <i class="fa-solid fa-credit-card"></i> My Payments
</a>
    <a href="{{ add_rev }}" class="{% if request.path == add_rev %}active{% endif %}"><i class="fa-solid fa-pen-fancy"></i> Create Review</a>
    <a href="{{ my_testi }}" class="{% if request.path == my_testi %}active{% endif %}"><i class="fa-solid fa-star"></i> My Reviews</a>
    <a href="{% url 'profile_settings' %}" class="{% if request.path == '/profile/' %}active{% endif %}">
    <i class="fa-solid fa-user-gear"></i> Profile Settings
</a>
<a href="{% url 'support_page' %}" class="{% if request.path == '/accounts/dashboard/support/' %}active{% endif %}">
    <i class="fa-solid fa-headset"></i> Support
</a>
{% endblock %}
{% block content %}
<div class="container-fluid p-0">
    <div class="row mb-3 align-items-center">
        <div class="col-6"><h4 class="fw-bold m-0">Order History</h4><p class="text-muted small mb-0">Track and manage orders.</p></div>
        <div class="col-6 text-end"><a href="{% url 'menu' %}" class="btn btn-danger btn-sm px-3 fw-bold rounded-3">New Order</a></div>
    </div>
    <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
        <div class="table-responsive"><table class="table table-hover align-middle mb-0 small">
            <thead class="bg-light fw-bold text-muted"><tr>
                <th class="ps-3 py-3">ID</th><th class="py-3">DATE</th><th class="py-3">TOTAL</th><th class="py-3">PAYMENT</th><th class="py-3">STATUS</th><th class="text-end pe-3">ACTIONS</th>
            </tr></thead>
            <tbody>
                {% for order in orders %}<tr class="border-bottom">
                    <td class="ps-3 fw-bold">#{{ order.id }}</td>
                    <td><div class="fw-bold">{{ order.created_at|date:"d M" }}</div><div class="text-muted x-small">{{ order.created_at|date:"H:i" }}</div></td>
                    <td class="fw-bold">à§³{{ order.total_price }}</td>
                    <td><span class="badge rounded-pill px-2 py-1 {% if order.is_paid %}bg-success-subtle text-success{% else %}bg-warning-subtle text-warning{% endif %}">{% if order.is_paid %}Paid{% else %}Unpaid{% endif %}</span></td>
                    <td><span class="badge bg-info-subtle text-info rounded-pill px-2 py-1">{{ order.get_status_display }}</span></td>
                    <td class="text-end pe-3"><div class="d-flex justify-content-end gap-1">
                        <a href="{% url 'track_order' order.id %}" class="btn btn-sm btn-outline-danger px-2 rounded-pill">Track</a>
                        <form action="{% url 'delete_order' order.id %}" method="POST" class="d-inline">{% csrf_token %}
                            <button class="btn btn-sm btn-light px-2 rounded-pill text-danger" onclick="return confirm('Delete?');"><i class="fa-solid fa-trash-can"></i></button>
                        </form>
                        <a href="{% url 'reorder_instant' order.id %}" class="btn btn-sm btn-danger rounded-pill px-3 shadow-sm">
    <i class="fa-solid fa-rotate-right me-1"></i> Reorder
</a>
                    </div></td>
                </tr>{% empty %}
                <tr><td colspan="6" class="text-center py-5 text-muted">No orders found. <a href="{% url 'menu' %}">Order now</a></td></tr>{% endfor %}
            </tbody>
        </table></div>
    </div>
</div>
<style>
    .bg-success-subtle { background:#e8f5e9!important; color:#2e7d32!important; } .bg-warning-subtle { background:#fff3e0!important; color:#ef6c00!important; }
    .bg-info-subtle { background:#e0f7fa!important; color:#00838f!important; } .x-small { font-size: 0.65rem; } .badge { font-size: 0.7rem; }
</style>
{% endblock %}
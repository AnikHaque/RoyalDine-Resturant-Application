{% extends 'base.html' %}{% block content %}
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<div class="container py-5 text-center">
    <h2 class="fw-bold mt-4">üéÅ Mystery Surprise Box</h2>
    <p class="text-muted small">Don't know what to eat? Let our AI Chef decide!</p>
    <div class="row justify-content-center mt-4"><div class="col-md-5">
        {% if not winning_food %}
            <div class="box-wrapper py-5 bg-white shadow-sm rounded-circle mx-auto" style="width:280px; height:280px;">
                <img src="https://cdn-icons-png.flaticon.com/512/679/679821.png" id="gift-box" class="img-fluid shake" width="150" style="cursor:pointer;">
                <h6 class="mt-3 fw-bold">Tap to reveal!</h6><p class="small text-danger">Fixed: ‡ß≥199</p>
            </div>
            <form method="POST" id="surprise-form">{% csrf_token %}</form>
        {% else %}
            <div class="card border-0 shadow-lg rounded-4 overflow-hidden animate__animated animate__zoomIn">
                <img src="{{ winning_food.image.url }}" class="card-img-top" style="height:220px; object-fit:cover;">
                <div class="card-body p-4">
                    <span class="badge bg-warning text-dark rounded-pill mb-2">You Won!</span>
                    <h3 class="fw-bold text-success">{{ winning_food.name }}</h3>
                    <div class="d-flex justify-content-between bg-light p-2 rounded-3 my-3">
                        <div class="small">Market: <del class="text-danger">‡ß≥{{ winning_food.price }}</del></div>
                        <div class="fw-bold small">Your Price: ‡ß≥199</div>
                    </div>
                    <div class="d-grid gap-2">
                        <a href="{% url 'add_to_cart' winning_food.id %}" class="btn btn-dark rounded-pill">Add to Cart</a>
                        <a href="{% url 'surprise_box' %}" class="btn btn-link btn-sm text-muted">Try Again?</a>
                    </div>
                </div>
            </div>
            <script>confetti({ particleCount:150, spread:70, origin:{y:0.6} });</script>
        {% endif %}
    </div></div>
</div>
<style>
    .shake { animation: shake 2s infinite; transition: 0.3s; } .shake:hover { transform: scale(1.1); animation: none; }
    @keyframes shake { 0%,100%{transform:rotate(0)} 10,30,50,70,90%{transform:rotate(-5deg)} 20,40,60,80%{transform:rotate(5deg)} }
</style>
<script>
    const b = document.getElementById('gift-box');
    if(b) b.onclick = () => { b.style.transform="scale(0.8)"; setTimeout(()=>document.getElementById('surprise-form').submit(), 300); };
</script>
{% endblock %}